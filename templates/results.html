<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Results - RE Quick Check</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <h2>Results</h2>

    <!-- === Problem-based Recommendations === -->
    {% if recommendation and recommendation|length > 0 %}
    <div class="recommendation-box">
        <h3>Recommendations based on problems</h3>
        <ul class="recommendation-list">
            {% for line in recommendation %}
            {% if 'DECREASE' in line or 'above' in line %}
                <li><span style="color:green;">âœ”</span> {{ line|safe }}</li>
            {% elif 'INCREASE' in line or 'below' in line %}
                <li><span style="color:orange;">âš </span> {{ line|safe }}</li>
            {% else %}
                <li><span style="color:orange;">âš </span> {{ line|safe }}</li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- === Peer Company Benchmarking === -->
    {% if peers is not none and peers.shape[0] > 0 %}
    <div class="recommendation-box">
        <h3>Peer Company Benchmarking</h3>
        <p>
          Peer companies are defined as organizations in the 
          <strong>same continent</strong>, operating in the 
          <strong>same industry</strong>, and of 
          <strong>similar team size</strong> (Â±25%).
        </p>

        {% if statistics and statistics|length > 0 %}
        <ul class="recommendation-list">
            {% for stat in statistics %}
            {% if 'below' in stat %}
                <li><span style="color:red;">âœ–</span> {{ stat }}</li>
            {% elif 'above' in stat %}
                <li><span style="color:green;">âœ”</span> {{ stat }}</li>
            {% else %}
                <li><span style="color:orange;">âš </span> {{ stat }}</li>
            {% endif %}
            {% endfor %}
        </ul>
        {% else %}
        <p>No specific advice could be derived, but <strong>{{ peers.shape[0] }}</strong> peer companies were found.</p>
        {% endif %}
    </div>
    {% else %}
    <div class="recommendation-box">
        <h3>Peer Company Benchmarking</h3>
        <p>There are no statistics as peer companies are not available.</p>
    </div>
    {% endif %}

    <!-- === External Resources (Always Visible) === -->
    <div class="recommendation-box">
        <h3>External Resources</h3>
        <ul class="recommendation-list">
            <li><span style="color:blue;">ðŸ”—</span> 
                <a href="https://www.fortiss.org/forschung/projekte/detail/s4kmu" target="_blank">
                    Fortiss S4KMU Project
                </a> : learning platform for SMEs to guide RE practices.
            </li>
            <li><span style="color:blue;">ðŸ”—</span> 
                <a href="http://napire.org/#/home" target="_blank">
                    NaPiRE Website
                </a> : publications and insights from the NaPiRE initiative.
            </li>
        </ul>
    </div>

    <!-- === Filter Form === -->
    <form method="GET" class="filter-form">
      <h3>Filter Benchmark Visuals</h3>

      <label for="filter_country">Filter by Country:</label>
      <select name="filter_country">
        <option value="">All</option>
        {% for country in countries %}
          <option value="{{ country }}" {% if filter_country == country %}selected{% endif %}>{{ country }}</option>
        {% endfor %}
      </select>

      <label for="filter_industry">Filter by Industry:</label>
      <select name="filter_industry">
        <option value="">All</option>
        {% for ind in industries %}
          <option value="{{ ind }}" {% if filter_industry == ind %}selected{% endif %}>{{ ind }}</option>
        {% endfor %}
      </select>

      <button type="submit">Apply Filters</button>
    </form>

    <!-- === Benchmark Visuals === -->
    {% if plots %}
    <div class="benchmarks">
      <h3>Benchmark Visuals</h3>
      <div class="plot-grid">
        {% for name, path in plots.items() %}
        <div class="plot-card">
          <img src="{{ url_for('static', filename=path) }}" alt="{{ name }}">
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <a href="{{ url_for('survey') }}" class="btn">ðŸ”„ Resubmit Answers</a>
  </div>
</body>
</html>
